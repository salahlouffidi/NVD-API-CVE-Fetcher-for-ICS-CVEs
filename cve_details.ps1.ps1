# Function to retrieve CVE details from NVD API
function Get-CveDetails {
    param (
        [string]$CveId
    )

    $url = "https://services.nvd.nist.gov/rest/json/cve/1.0/$CveId"
    $retryCount = 0
    $retryDelay = 1

    while ($retryCount -lt 5) {
        try {
            $response = Invoke-RestMethod -Uri $url
            if ($response.result.CVE_Items) {
                $cveData = $response.result.CVE_Items[0].cve
                $cveTitle = $cveData.CVE_data_meta.CVE_title
                $cveDescription = $cveData.description.description_data[0].value

                $cveDetails = @{
                    CveId = $CveId
                    Title = $cveTitle
                    Description = $cveDescription
                }

                return $cveDetails
            }
        }
        catch {
            Write-Host "Error retrieving details for CVE ID: $CveId"
            Write-Host "Retrying in $retryDelay seconds..."
            Start-Sleep -Seconds $retryDelay
            $retryCount++
            $retryDelay *= 2
        }
    }

    Write-Host "Failed to retrieve details for CVE ID: $CveId"
    return $null
}

# CSV file path
$csvFilePath = "C:\Users\salahlouffi\Desktop\ss.csv"

# Read the CSV file and extract CVE IDs
$cveIds = Get-Content -Path $csvFilePath

# Create an HTML file
$htmlFilePath = "C:\Users\salahlouffi\Desktop\cve_details.html"
$htmlContent = "<html><body>"

# Process each CVE ID
foreach ($cveId in $cveIds) {
    $cveDetails = Get-CveDetails -CveId $cveId

    if ($cveDetails) {
        # Generate HTML content for CVE details
        $htmlContent += "<h2>CVE ID: $($cveDetails.CveId)</h2>"
        $htmlContent += "<p><b>Title:</b> $($cveDetails.Title)</p>"
        $htmlContent += "<p><b>Description:</b> $($cveDetails.Description)</p>"
        $htmlContent += "<hr>"
    }

    # Delay to avoid rate limiting
    Start-Sleep -Seconds 1
}

$htmlContent += "</body></html>"

# Save the HTML content to the file
$htmlContent | Out-File -FilePath $htmlFilePath

Write-Host "CVE details have been saved to: $htmlFilePath"
